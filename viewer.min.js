/**
 * @preserve
 * @file Script to add a GLB object viewer to Empretienda
 * @author Keyvin Duque <thkeyduq@gmail.com>
 * @license MIT
 * @copyright Keyvin Duque 2022
 * @endpreserve
 */
import*as THREE from"three";import{GLTFLoader}from"three/addons/loaders/GLTFLoader.js";import{OrbitControls}from"three/addons/controls/OrbitControls.js";import{RoomEnvironment}from"three/addons/environments/RoomEnvironment.js";const elements=document.getElementsByClassName("product-vip__description");let element=Array.from(elements).find((e=>null!=e.offsetParent)),count=0;for(const e of elements){const n=`souzo_viewer_${count}`;e.innerHTML=e.innerHTML.replace("<p>{__preview__}</p>",`\n    <button \n      class="button button--full background--primary background--primary-hover contrast_text--primary contrast_text--primary-hover uk-button uk-button-input border-radius" \n      id="${n}_btn_open" type="button" onclick="showViewer('${n}')">\n      Ver modelo 3D\n    </button>\n    <div id="${n}_loading"></div>\n    <div id="${n}"></div>\n    `),count++}function render(e,n,t){e.render(n,t)}function onResize(e,n,t,o,r){t.aspect=o/r,t.updateProjectionMatrix(),e.setSize(o,r),render(e,n,t)}function getSlug(){const e=window.location.pathname;return e.substring(e.lastIndexOf("/")+1)}function fitCameraToCenteredObject(e,n,t){const o=new THREE.Box3;o.setFromObject(n);const r=o.getCenter(new THREE.Vector3),i=o.getSize(new THREE.Vector3),d=Math.max(i.x,i.y,i.z);let s=new THREE.Vector3(d,d,d);e.zoom=.5,e.left=-2*d,e.bottom=-2*d,e.top=2*d,e.right=2*d,e.near=.01,e.far=100*d,e.position.set(s.x,s.y,s.z),e.lookAt(0,0,0),e.updateProjectionMatrix(),t.target.set(r.x,r.y,r.z),t.update()}window.showViewer=function(e){const n=document.getElementById(e),t=document.getElementById(`${e}_loading`),o=document.getElementById(`${e}_btn_open`),r=element.clientWidth,i=Math.min(element.clientWidth,window.innerHeight),d=new THREE.WebGLRenderer({antialias:!0});d.setPixelRatio(window.devicePixelRatio),d.setSize(r,i),d.outputEncoding=THREE.sRGBEncoding,d.shadowMap.enabled=!0,d.shadowMap.type=THREE.PCFSoftShadowMap,n.appendChild(d.domElement);const s=new THREE.PMREMGenerator(d),a=new THREE.Scene;a.background=new THREE.Color(16777215),a.environment=s.fromScene(new RoomEnvironment).texture;const c=new THREE.DirectionalLight(16777215,1);c.position.set(1,1,1),c.castShadow=!0,c.shadow.camera.far=1e3,a.add(c);const l=new THREE.PerspectiveCamera(30,r/i,1,1e3);(new GLTFLoader).setPath("https://cdn.jsdelivr.net/gh/keyduq/souzo-viewer@master/samples/").load(`${getSlug()}_preview.glb`,(function(e){const n=e.scene;n.traverse((function(e){if(e.isMesh){e.castShadow=!0;const n=new OrbitControls(l,d.domElement);fitCameraToCenteredObject(l,e,n),n.addEventListener("change",(()=>{onResize(d,a,l,r,i)}))}})),a.add(n),render(d,a,l),o.style.display="none",t.innerHTML=""}),(function(e){o.style.display="none",t.innerHTML="Loading..."}),(function(e){o.style.display="display"}))},window.closeViewer=function(e){const n=document.etElementById(e),t=document.getElementById(`${e}_btn_open`),o=document.getElementById(`${e}_btn_close`);n.innerHTML="",t.style.display="block",o.style.display="none"};