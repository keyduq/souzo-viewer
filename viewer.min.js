/**
 * @preserve
 * @file Script to add a GLB object viewer to Empretienda
 * @author Keyvin Duque <thkeyduq@gmail.com>
 * @license MIT
 * @copyright Keyvin Duque 2022
 * @endpreserve
 */
import*as THREE from"three";import{GLTFLoader}from"three/addons/loaders/GLTFLoader.js";import{OrbitControls}from"three/addons/controls/OrbitControls.js";import{RoomEnvironment}from"three/addons/environments/RoomEnvironment.js";const elements=document.getElementsByClassName("product-vip__description");let element=Array.from(elements).find((e=>null!=e.offsetParent)),count=0;for(const e of elements){const n=`souzo_viewer_${count}`;e.innerHTML=e.innerHTML.replace("<p>{__preview__}</p>",`\n    <button id="${n}_btn_open" type="button" onclick="showViewer('${n}')">Ver modelo 3D</button>\n    <div id="${n}_loading"></div>\n    <div id="${n}"></div>\n    <button style="display: none;" id="${n}_btn_close" type="button" onclick="closeViewer('${n}')">Cerrar modelo</button>\n    `),count++}function render(e,n,t){e.render(n,t)}function onResize(e,n,t,o,i){t.aspect=o/i,t.updateProjectionMatrix(),e.setSize(o,i),render(e,n,t)}function getSlug(){const e=window.location.pathname;return e.substring(e.lastIndexOf("/")+1)}function fitCameraToCenteredObject(e,n,t){const o=new THREE.Box3;o.setFromObject(n);const i=o.getCenter(new THREE.Vector3),r=o.getSize(new THREE.Vector3),d=Math.max(r.x,r.y,r.z);let s=new THREE.Vector3(d,d,d);e.zoom=.5,e.left=-2*d,e.bottom=-2*d,e.top=2*d,e.right=2*d,e.near=.01,e.far=100*d,e.position.set(s.x,s.y,s.z),e.lookAt(0,0,0),e.updateProjectionMatrix(),t.target.set(i.x,i.y,i.z),t.update()}window.showViewer=function(e){const n=document.getElementById(e),t=document.getElementById(`${e}_loading`),o=document.getElementById(`${e}_btn_open`),i=document.getElementById(`${e}_btn_close`),r=element.clientWidth,d=Math.min(element.clientWidth,window.innerHeight),s=new THREE.WebGLRenderer({antialias:!0});s.setPixelRatio(window.devicePixelRatio),s.setSize(r,d),s.outputEncoding=THREE.sRGBEncoding,s.shadowMap.enabled=!0,s.shadowMap.type=THREE.PCFSoftShadowMap,n.appendChild(s.domElement);const a=new THREE.PMREMGenerator(s),c=new THREE.Scene;c.background=new THREE.Color(16777215),c.environment=a.fromScene(new RoomEnvironment).texture;const l=new THREE.DirectionalLight(16777215,1);l.position.set(1,1,1),l.castShadow=!0,l.shadow.camera.far=1e3,c.add(l);const m=new THREE.PerspectiveCamera(30,r/d,1,1e3);(new GLTFLoader).setPath("https://cdn.jsdelivr.net/gh/keyduq/souzo-viewer@master/samples/").load(`${getSlug()}_preview.glb`,(function(e){const n=e.scene;n.traverse((function(e){if(e.isMesh){e.castShadow=!0;const n=new OrbitControls(m,s.domElement);fitCameraToCenteredObject(m,e,n),n.addEventListener("change",(()=>{onResize(s,c,m,r,d)}))}})),c.add(n),render(s,c,m),o.style.display="none",i.style.display="block",t.innerHTML=""}),(function(e){t.innerHTML="Loading..."}),(function(e){}))},window.closeViewer=function(e){const n=document.etElementById(e),t=document.getElementById(`${e}_btn_open`),o=document.getElementById(`${e}_btn_close`);n.innerHTML="",t.style.display="block",o.style.display="none"};